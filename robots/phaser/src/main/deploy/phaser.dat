#
# This file describes the phaser robot.
#

###################################################################################################
#
# Hardware definitions, this is the equivalent of the old signal power table, 
# at least the signal part of it.
#
###################################################################################################


#
# Drivebase
#
hw:tankdrive:leftmotor:1                                        4               # TALON SRX
hw:tankdrive:leftmotor:2                                        5               # TALON SRX
hw:tankdrive:rightmotor:2                                       2               # TALON SRX
hw:tankdrive:rightmotor:3                                       3               # TALON SRX
hw:tankdrive:leftencoder:1                                      1               # Digital IO
hw:tankdrive:leftencoder:2                                      0               # Digital IO
hw:tankdrive:rightencoder:1                                     2               # Digital IO
hw:tankdrive:rightencoder:2                                     3               # Digital IO
hw:tankdrive:invert:motors:left                                 true
hw:tankdrive:shifter                                            0               # Solenoid
endif

if COMPETITION
hw:tankdrive:leftmotor:1                                        1               # TALON SRX
hw:tankdrive:leftmotor:2                                        2               # TALON SRX
hw:tankdrive:leftmotor:3                                        3               # TALON SRX
hw:tankdrive:rightmotor:1                                       4               # TALON SRX
hw:tankdrive:rightmotor:2                                       5               # TALON SRX
hw:tankdrive:rightmotor:3                                       6               # TALON SRX
hw:tankdrive:leftencoder:1                                      2               # Digital IO
hw:tankdrive:leftencoder:2                                      3               # Digital IO
hw:tankdrive:rightencoder:1                                     1               # Digital IO
hw:tankdrive:rightencoder:2                                     0               # Digital IO
hw:tankdrive:invert:motors:left                                 true
hw:tankdrive:shifter                                            0               # Solenoid
endif

#
# Carlos hatch holder
#
if PRACTICE
hw:carloshatch:holder                                           5               # Solenoid
hw:carloshatch:arm:extend                                       6               # Solenoid
hw:carloshatch:arm:retract                                      7               # Solenoid
endif

if COMPETITION
hw:carloshatch:holder                                           7               # Solenoid
hw:carloshatch:arm:extend                                       5               # Solenoid
hw:carloshatch:arm:retract                                      6               # Solenoid
endif

hw:carloshatch:sensor                                           0               # Analog IO
hw:carloshatch:impact                                           21              # Digital IO

#
# Lift
#
hw:lifter:motor:1                                               10              # TalonSRX
hw:lifter:motor:2                                               11              # TalonSRC
hw:lifter:reversemotors                                         true
hw:lifter:encoder1                                              8               # Digital IO
hw:lifter:encoder2                                              9               # Digital IO

#
# turntable
#
hw:turntable:encoder1                                           4               # Digital IO
hw:turntable:encoder2                                           5               # Ditigal IO
hw:turntable:motor:1                                            8               # TALON SRX

#
# Front line sensors
#
hw:linesensor:front:0                                           10              # Digital IO
hw:linesensor:front:1                                           11              # Digital IO
hw:linesensor:front:2                                           12              # Digital IO

#
# Back line sensors
#
hw:linesensor:back:0                                            13              # Digital IO
hw:linesensor:back:1                                            18              # Digital IO
hw:linesensor:back:2                                            19              # Digital IO

#
# Driver station
#
hw:driverstation:hid:driver                                     0               # HID Device Index
hw:driverstation:hid:oi                                         2               # HID Device Index

#
# cargoholder
#
hw:cargoholder:sensor                                           20              # Digital IO
hw:cargoholder:motor                                            7               # Victor SPX

#
# cargo intake
#
hw:cargointake:motor                                            9               # Victor SPX
hw:cargointake:solenoid                                         1               # Solenoid
hw:cargointake:sensor                                           22              # Sensor

#
# Climber
#
hw:climber:solenoid                                             2               # Solenoid

###################################################################
#
# The sections below describe the software parameters for the various
# robot subsystems
#
###################################################################

###################################################################################################
# misc
###################################################################################################

#
# Setup the data plotter.  If the value plotter:plot is set, many of the subsystem send data out
# in UDP packets that the DataPlotter can plot.  Very useful for tuning PID and follower control
# We generally keep this on with the practice bot and off for the competition bot
#
if PRACTICE
plotter:port                                                    5555
endif

###################################################################################################
# tankdrive
###################################################################################################

#
# Variables for the tankdrive subsystem code.
#
tankdrive:inches_per_tick                                       0.010385891
tankdrive:width                                                 22
tankdrive:scrub                                                 0.95177665

tankdrive:follower:left:ka                                      0.0025
tankdrive:follower:left:kv                                      0.006112469         # 0.005
tankdrive:follower:left:kp                                      0.03248             # Recommended 0.02032 - 0.03048
tankdrive:follower:left:kd                                      0.0

tankdrive:follower:right:ka                                     0.0025
tankdrive:follower:right:kv                                     0.006112469         # 0.005
tankdrive:follower:right:kp                                     0.03248             # Recommended 0.02032 - 0.03048
tankdrive:follower:right:kd                                     0.0

tankdrive:follower:turn_correction                              0
tankdrive:follower:angle_correction                             0.06

tankdrive:distance_action:maxa                                  36.0
tankdrive:distance_action:maxd                                  -36.0
tankdrive:distance_action:maxv                                  36.0

tankdrive:distance_action:angle_pid:p                           0.0
tankdrive:distance_action:angle_pid:i                           0.0
tankdrive:distance_action:angle_pid:d                           0.0
tankdrive:distance_action:angle_pid:f                           0.0
tankdrive:distance_action:angle_pid:min                         -1.0
tankdrive:distance_action:angle_pid:max                         1.0
tankdrive:distance_action:angle_pid:imax                        0.0

tankdrive:distance_action:distance_threshold                    999.0
tankdrive:distance_action:profile_outdated_error_long           8.0
tankdrive:distance_action:profile_outdated_error_short          4.0
tankdrive:distance_action:profile_outdated_error_dist           12.0


###################################################################################################
# turntable
###################################################################################################

#
# Variables for the turntable
#
turntable:safe_lifter_height                                    13
turntable:safe_lifter_margin                                    4
turntable:keepout:minimum                                       130
turntable:keepout:maximum                                       160
turntable:keepout:dangerzone                                    15

turntable:calibrate:threshold                                   1               
if PRACTICE
turntable:calibrate:encbase                                     238             
endif

if COMPETITION
turntable:calibrate:encbase                                     240
endif

turntable:calibrate:power                                       0.2             
turntable:calibrate:samples                                     32              

if PRACTICE
turntable:degrees_per_tick                                      0.60916263086705202312138728323699
endif

if COMPETITION
#turntable:degrees_per_tick                                      0.546283784
#turntable:degrees_per_tick                                      0.538800444
turntable:degrees_per_tick                                      0.55387105877777777777777777777778
endif

turntable:maxa                                                  420
turntable:maxd                                                  -420
turntable:maxv                                                  300

turntable:base                                                  0.0
turntable:threshold                                             1.0
turntable:follower:kv                                           0.0036
turntable:follower:ka                                           0.0
turntable:follower:kp                                           0.031
turntable:follower:kd                                           0.0
turntable:hold:p                                                0.1
turntable:hold:i                                                0.0
turntable:hold:d                                                0.0
turntable:hold:f                                                0.0
turntable:hold:a                                                0.0
turntable:hold:min                                              -0.5
turntable:hold:max                                              0.5
turntable:hold:imax                                             0.0

turntable:angle:cargo:floor_collect                             -90.0
turntable:angle:hatch:floor_collect                             0.0

turntable:angle:cargo:collect:north                             90
turntable:angle:cargo:collect:south                             -90
turntable:angle:cargo:collect:east                              0
turntable:angle:cargo:collect:west                              178

turntable:angle:cargo:place:north                               90
turntable:angle:cargo:place:south                               -90
turntable:angle:cargo:place:east                                0
turntable:angle:cargo:place:west                                178

turntable:angle:hatch:collect:north                             0                
turntable:angle:hatch:collect:south                             178                
turntable:angle:hatch:collect:east                              -90                
turntable:angle:hatch:collect:west                              90                
 
turntable:angle:hatch:place:north                               0                
turntable:angle:hatch:place:south                               178                
turntable:angle:hatch:place:east                                -90                
turntable:angle:hatch:place:west                                90      

###################################################################################################
# lifter
###################################################################################################

#
# Variables for the lifter
#
lifter:base							                            10.75
lifter:inches_per_tick                                          0.058691309

lifter:calibrate:up:power                                       0.4                         
lifter:calibrate:hold:power                                     0.25                         
lifter:calibrate:up:time                                        1.0                         
lifter:calibrate:threshold                                      2                           
lifter:calibrate:encbase                                        0                         
lifter:calibrate:power                                          -0.4                        
lifter:calibrate:samples                                        16                           

lifter:max_height                                               83.66
lifter:min_height                                               8.46
lifter:threshold                                                1.0

lifter:maxv                                                     33               # 30
lifter:maxa                                                     60               # 30
lifter:maxd                                                     -60              # -30

lifter:follower:up:kp                                           0.2
lifter:follower:up:ka                                           0.00056179776
lifter:follower:up:kv                                           0.028089888
lifter:follower:up:kd                                           0.0

lifter:follower:down:kp                                         0.2
lifter:follower:down:ka                                         0.00056179776
lifter:follower:down:kv                                         0.028089888
lifter:follower:down:kd                                         0.0

lifter:hold:p                                                   -0.15              
lifter:hold:i                                                   0.0                 
lifter:hold:d                                                   0.0                 
lifter:hold:f                                                   0.0                 
lifter:hold:a                                                   0.0                 
lifter:hold:min                                                -0.6          
lifter:hold:max                                                 0.6                
lifter:hold:imax                                                0.0                 

#
# Note, the heights are referenced to the floor.  The height of the lifter is the height of the
# bottom plate of the cargo holder.
#
# The offsets from this are
#
# cargo_holder_center, the height of the cargo holder center above the lifter height
# hatch_center, the height of the center of a hatch on the hatch holder above the lifter height
# hatch_hook_center, the height of the center of the hatch holder above the lifter height
#
lifter:height:cargo:floor_collect                               9.0
lifter:height:offset:cargo_holder_center                        6.75
lifter:height:offset:hatch_center                               5.5
lifter:height:offset:hatch_hook_center                          8.6                               
lifter:height:hatch:floor_collect                               12.0
lifter:height:hatch:undock_intake                               22.00
lifter:height:loadingstation:hatch:shift_up                     5
lifter:height:score:hatch:shift_down                            -4.0
lifter:height:turtle                                            15.0

#
# Cargo
#

lifter:height:cargo:collect:north                               38
lifter:height:cargo:collect:south                               38
lifter:height:cargo:collect:east                                38
lifter:height:cargo:collect:west                                38

lifter:height:cargo:place:north:1                               23
lifter:height:cargo:place:south:1                               23
lifter:height:cargo:place:east:1                                23
lifter:height:cargo:place:west:1                                23

lifter:height:cargo:place:north:2                             52
lifter:height:cargo:place:south:2                             52
lifter:height:cargo:place:east:2                              52
lifter:height:cargo:place:west:2                              52

lifter:height:cargo:place:north:3                             80
lifter:height:cargo:place:south:3                             80
lifter:height:cargo:place:east:3                              80
lifter:height:cargo:place:west:3                              80

lifter:height:cargo:place:north:c                             40
lifter:height:cargo:place:south:c                             40
lifter:height:cargo:place:east:c                              40
lifter:height:cargo:place:west:c                              40

#
# Hatches
#

lifter:height:hatch:collect:north                             14              
lifter:height:hatch:collect:south                             14                 
lifter:height:hatch:collect:east                              14
lifter:height:hatch:collect:west                              14                 

lifter:height:hatch:place:north:1                             14      
lifter:height:hatch:place:south:1                             14       
lifter:height:hatch:place:east:1                              14               
lifter:height:hatch:place:west:1                              14   

lifter:height:hatch:place:north:2                             43.5           
lifter:height:hatch:place:south:2                             43.5            
lifter:height:hatch:place:east:2                              43.5                 
lifter:height:hatch:place:west:2                              43.5
               
lifter:height:hatch:place:north:3                             71.5
lifter:height:hatch:place:south:3                             71.5                
lifter:height:hatch:place:east:3                              71.5                 
lifter:height:hatch:place:west:3                              71.5

lifter:height:hatch:place:north:c                             14
lifter:height:hatch:place:south:c                             14
lifter:height:hatch:place:east:c                              14        
lifter:height:hatch:place:west:c                              14            

lifter:height:offset:hatch_hook_center                        8.6
lifter:height:cargo:undock_height                             22.00
lifter:height:cargo:collected                                 23

###################################################################################################
# cameratracker
###################################################################################################

cameratracker:distance_threshold                                48.0            # 60
cameratracker:rect_ratio_min                                    0.9
cameratracker:rect_ratio_max                                    1.1

###################################################################################################
# drive by vision (simple P only control)
###################################################################################################

drivebyvision:yaw_base_power                                    0.30
drivebyvision:yaw_p                                             0.03

###################################################################################################
# drive by line follower
###################################################################################################

linefollower:front:power                                          0.25
linefollower:front:distance                                       12
linefollower:front:adjust                                         0.0

linefollower:back:power                                           -0.25
linefollower:back:distance                                        12
linefollower:back:adjust                                          -0.0

linefollower:stalled_threshold                                    0.1

cargointake:power                                                -0.6
cargointake:reverse:power                                        0.6

cargoholder:collect:power                                       0.6
cargoholder:score:power                                         -0.8

cargoholder:score:time                                          1.0

cargointake:delay                                               0.06

if PRACTICE
hatchholder:collect:delay                                       0.2
hatchholder:collect:totaldelay                                  0.2
hatchholder:specialflow:delay                                   0.1
hatchholder:place:delay                                         0.2
hatchholder:place:totaldelay                                    0.2
hatchholder:default:delay                                       0.750
endif

if COMPETITION
hatchholder:collect:delay                                       0.25
hatchholder:collect:totaldelay                                  0.25
hatchholder:specialflow:delay                                   0.1
hatchholder:place:delay                                         0.5
hatchholder:place:totaldelay                                    0.5
hatchholder:default:delay                                       0.75
endif

hatchholder:finger:autodelay                                    1.0
hatchholder:debounce:low2high                                   0.2
hatchholder:debounce:high2low                                   0.4

climb:deploy_delay                                              1.25

climb:drive:left                                                -0.4
climb:drive:right                                               -0.4
climb:drive:duration                                            4.0

climb:backup:left                                               0.0
climb:backup:right                                              0.0
climb:backup:duration                                           0.0

climb:velocity_samples                                          16
climb:still_threshold                                           2           # in / sec
climb:backup_delay                                              2.5

#
# Variables for the driver gamepad
#
driver:power:max                                                1.0
driver:power:default                                            0.6
driver:turn:max                                                 0.8
driver:turn:default                                             0.4
driver:power:slowby                                             0.5
driver:power:tolerance                                          0.05
driver:power:nudge_straight                                     0.2
driver:power:nudge_rotate                                       0.2
driver:nudge_time                                               0.1
driver:zerolevel                                                0.1

oi:hatch_cargo_switch                                           11                  # Button
oi:climb_lock_switch                                            15                  # Button
oi:compass_north                                                13                  # Button
oi:compass_south                                                14                  # Button
oi:compass_east                                                 9                   # Button
oi:compass_west                                                 12                  # Button
oi:height_level_one                                             1                   # Button
oi:height_level_two                                             2                   # Button
oi:height_level_three                                           3                   # Button
oi:height_cargo_bay                                             4                   # Button
oi:collect_floor                                                5                   # Button
oi:go                                                           10                  # Button
oi:turtle                                                       6                   # Button
oi:climb                                                        8                   # Button
oi:calibrate                                                    16                  # Button
oi:reverse                                                      7                   # Button
oi:automode                                                     6                   # Axis
oi:tracking_viewing_nothing_switch                              3                   # Axis
oi:ship_rocket                                                  4                   # Axis
oi:extra_arm_button                                             false

#
# Semi-auto modes
#
strafe:ship:shoot_distance                                      16.0
strafe:ship:velocity_factor                                     0.19

strafe:rocket:shoot_distance                                    16
strafe:rocket:velocity_factor                                   0.19
strafe:hatch:distance                                           15.5

#
# Cargo tracking
#
cargotracking:kp                                                0.1
cargotracking:width                                             14.0

#
# Score cargo
#
scorehatch:offset:0                                             0.0
scorehatch:offset:1                                             0.0
scorehatch:offset:2                                             0.0
scorehatch:offset:3                                             0.0
scorehatch:offset:4                                             0.0
scorehatch:offset:5                                             0.0
scorehatch:offset:6                                             0.0
scorehatch:offset:7                                             0.0

carloshatch:impact:low2high                                      0.200
carloshatch:impact:high2low                                      0.200
carloshatch:presence:high2low                                    0.100
carloshatch:presence:low2high                                    0.100
carloshatch:threshold                                            0.75
carloshatch:pushtime                                             0.5
carloshatch:waitforhooks                                         0.5
